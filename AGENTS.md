# Repository Guidelines

## Project Structure & Module Organization
- `account_sdk/`: Core Rust SDK (controllers, sessions, signers, storage). Key entry points include `account_sdk/src/controller.rs` and `account_sdk/src/session.rs`.
- `account-wasm/`: WASM bindings for JS/TS; build outputs live under `pkg-*` directories generated by the build script.
- `contracts/`: Cairo smart contracts (e.g., `contracts/resolver/`).
- `scripts/` and `bin/`: Utility and lint scripts (pre-commit, schema updates, etc.).
- Tests live alongside Rust code (notably `account_sdk/src/tests/`).

## Build, Test, and Development Commands
- `cargo build`: Build the Rust workspace.
- `cargo test`: Run the Rust test suite.
- `make test-session`: Run session-specific tests with logging (Katana-based integration tests).
- `cd account-wasm && ./build.sh`: Build optimized WASM packages (`pkg-controller`, `pkg-session`).
- `make generate_artifacts`: Build Cairo contracts and generate artifacts.
- `make lint`: Run all linters (rustfmt, clippy, scarb fmt, prettier).
- `make lint-rust | make lint-cairo | make lint-prettier`: Run a specific linter.
- `make lint-check`: Verify formatting without applying changes.
- `./scripts/pull_schema.sh`: Refresh GraphQL schema from Cartridge API.

## Coding Style & Naming Conventions
- Rust formatting is enforced by `rustfmt` (`.rustfmt.toml`).
- Linting is enforced by `clippy` (warnings are treated as failures in lint scripts).
- Use standard Rust naming: `snake_case` for functions/modules, `CamelCase` for types, `SCREAMING_SNAKE_CASE` for constants.
- Cairo and documentation formatting are enforced via `scarb fmt` and `prettier` when available.

## Testing Guidelines
- Rust tests use the standard Rust test harness.
- Integration tests are primarily under `account_sdk/src/tests/` and use a local Katana node; prefer `make test-session` for session flows.
- Name tests descriptively for the behavior being verified (e.g., `test_session_approval_filters`).

## Commit & Pull Request Guidelines
- Commit messages commonly follow Conventional Commit style (`feat:`, `fix:`, `refactor:`, `ci:`) and often include a PR number suffix like `(#123)`; follow that pattern when possible.
- PRs should include: a concise description, relevant issue links, and test/lint commands run. Include screenshots or logs when changes affect WASM or contract outputs.

## Pre-commit Hooks
- Run `make setup-pre-commit` to enable repo hooks in `.githooks`.
- Hooks format and lint staged files; if they rewrite files, re-add them before committing.
